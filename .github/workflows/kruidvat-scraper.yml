name: Scrape Kruidvat Odorex

on:
  schedule:
    - cron: '0 0 * * *'  # Dagelijkse run om middernacht
  workflow_dispatch:  # Handmatige trigger mogelijk

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Haal repository op
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Haalt de volledige repo op, voorkomt conflicten

      - name: ğŸ› ï¸ Controleer structuur
        run: |
          ls -lah
          ls -lah scripts/

      - name: ğŸ Installeer Python en dependencies
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - run: pip install requests beautifulsoup4

      - name: ğŸ” Controleer en draai scraper
        run: |
          if [ -f scripts/scraper-kruidvat-odorex.py ]; then
            echo "âœ… Script gevonden! Nu uitvoeren..."
            python scripts/scraper-kruidvat-odorex.py
          else
            echo "âŒ FOUT: Script niet gevonden in scripts/!"
            exit 1
          fi

      - name: ğŸ“„ Controleer JSON inhoud
        run: cat src/data/scraper-kruidvat-odorex.json

      - name: ğŸš€ Commit en push veranderingen
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          git add -A  # Voeg ALLE wijzigingen toe
          
          if git diff --staged --quiet; then
            echo "âš ï¸ Geen wijzigingen gevonden, commit overslaan."
          else
            git commit -m "ğŸ”„ Update Kruidvat JSON en pagina"
            git push origin main
          fi

      - name: ğŸŒ Trigger GitHub Pages Build (indien nodig)
        run: |
          curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/daandobber/daandobber.github.io/pages/builds || echo "âš ï¸ GitHub Pages niet ingeschakeld"
